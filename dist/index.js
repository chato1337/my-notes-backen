(()=>{var e={763:(e,t,o)=>{const n=o(398);e.exports={getBills:function(){return new Promise(((e,t)=>{e(n.list())}))},addPay:function(e){return new Promise(((t,o)=>{t(n.addPay(e))}))},addBill:function(e){return new Promise(((t,o)=>{t(n.addBill(e))}))},getHistory:function(){return new Promise(((e,t)=>{e(n.historyList())}))},approvePay:function(e){return new Promise(((t,o)=>{t(n.approve(e))}))}}},470:(e,t,o)=>{const n=o(185),s=new(0,n.Schema)({value:String,date:String,money:String,owner:String,extra:String,status:String}),r=n.model("bills",s);e.exports=r},84:(e,t,o)=>{const n=o(860).Router(),s=o(763),r=o(511);n.get("/bills",((e,t)=>{s.getBills().then((e=>{t.send(e)})).catch((e=>console.log(e)))})),n.get("/bills-auth",r.authenticate("jwt",{session:!1}),((e,t)=>{s.getBills().then((e=>{t.send(e)})).catch((e=>console.log(e)))})),n.get("/bill-history",((e,t)=>{s.getHistory().then((e=>t.send(e))).catch((e=>console.log(e)))})),n.post("/add-pay",((e,t)=>{s.addPay(e.body).then((e=>t.send(e))).catch((e=>console.log(e)))})),n.post("/approve-pay",((e,t)=>{s.approvePay(e.body).then((e=>t.send(e))).catch((e=>console.log(e)))})),n.post("/add-bill",((e,t)=>{s.addBill(e.body).then((()=>t.send("bill added"))).catch((e=>console.log(e)))})),e.exports=n},398:(e,t,o)=>{const n=o(470),s=o(126),r=o(669),a=o(467);e.exports={list:async function(){return await n.find()},addPay:async function(e){const t={_id:e.id},o=await n.findOne(t);let a,i="pending";if("credit"===e.concept){const t=parseInt(o.value)+parseInt(e.value);a=t,i="approved",await n.findByIdAndUpdate(e.id,{$set:{value:t}},{useFindAndModify:!1})}else{const t=o.value-e.value;a=t,await n.findByIdAndUpdate(e.id,{$set:{value:t}},{useFindAndModify:!1})}const c={...o,value:a},d=s.generateTicket(c._doc,e.concept,e.value,i);return new r(d).save(),c._doc},addBill:async function(e){const t={value:e.value,date:e.date,money:e.money,owner:e.owner,extra:e.extra,status:e.status},o=new n(t);return o.save(),o},historyList:async function(){return await r.find({color:"ticket"}).sort({_id:"desc"})},approve:async function(e){const t={_id:e.id},o=await r.findOne(t);if("Aprobar"===e.status){const e=s.approveTicket(o,"aprobado");return await r.updateOne(t,e,a.handleError())}{const i=await n.findOne({_id:o.footer}),c=parseInt(i.value)+parseInt(e.value);await n.findByIdAndUpdate(e.id,{$set:{value:c}},{useFindAndModify:!1});const d=s.approveTicket(o,"rechazado");return await r.updateOne(t,d,a.handleError())}}}},509:(e,t,o)=>{const n=o(232);e.exports={getNotes:function(){return new Promise(((e,t)=>{e(n.list())}))},addNote:function(e){return console.log(e),new Promise(((t,o)=>{t(n.add(e))}))},editNote:function(e){return console.log(e),new Promise(((t,o)=>{t(n.edit(e))}))},deleteNote:function(e){return new Promise(((t,o)=>{t(n.delete(e))}))}}},669:(e,t,o)=>{const n=o(185),s=new(0,n.Schema)({title:String,body:String,footer:String});s.add({color:String}),s.add({append:Object});const r=n.model("notes",s);e.exports=r},527:(e,t,o)=>{const n=o(860).Router(),s=o(509);n.get("/",((e,t)=>{s.getNotes().then((e=>{t.send(e)})).catch((e=>console.log(e)))})),n.post("/note",((e,t)=>{s.addNote(e.body).then((e=>{console.log("guardados correctamente"),t.send("datos guardados")})).catch((e=>console.log(e)))})),n.put("/edit-note",((e,t)=>{s.editNote(e.body).then((e=>{console.log("nota actualizada"),t.send("nota actualizada")})).catch((e=>console.log(e)))})),n.delete("/delete",((e,t)=>{s.deleteNote(e.body).then((e=>{console.log("nota eliminada"),t.send("nota eliminada")})).catch((e=>console.log(e)))})),e.exports=n},232:(e,t,o)=>{const n=o(669),s=o(467);e.exports={list:async function(){return await n.find()},add:async function(e){console.log(e),new n(e).save()},edit:async function(e){const t={_id:e._id},o={title:e.title,body:e.body,footer:e.footer,color:e.color};n.updateOne(t,o,s.handleError)},delete:async function(e){n.findOneAndDelete(e,null,s.handleError)}}},57:(e,t,o)=>{const n=o(230);e.exports={login:function(e){return new Promise(((t,o)=>{t(n.checkLogin(e))}))},register:function(e){return new Promise(((t,o)=>{t(n.add(e))}))},getUsers:function(){return new Promise(((e,t)=>{e(n.list())}))}}},340:(e,t,o)=>{const n=o(185),s=new(0,n.Schema)({username:String,email:String,password:String,role:String});s.add({country:String});const r=n.model("users",s);e.exports=r},644:(e,t,o)=>{const n=o(860).Router(),s=o(57),{checkApiKey:r}=o(954),a=o(511);n.post("/login",a.authenticate("local",{session:!1}),((e,t)=>{s.login(e.body).then((e=>{t.json(e)})).catch((e=>console.log(e)))})),n.post("/signup",((e,t)=>{s.register(e.body).then((e=>{console.log(e),t.send(e)})).catch((e=>console.log(e)))})),n.get("/customers",r,((e,t)=>{s.getUsers().then((e=>t.send(e))).catch((e=>console.log(e)))})),e.exports=n},230:(e,t,o)=>{const n=o(340),s=(o(344),o(632)),r=o(96),{signToken:a}=o(954);e.exports={add:async function(e){const t={username:e.username,email:e.email,password:await r.hash(e.password,10),role:e.role||"user",country:e.country||"col"},o=new n(t);return o.save(),o},checkLogin:async function(e){const t={username:e.username},o=await n.findOne(t),r={sub:o._id,role:o.role};return{user:o,token:a(r,s.secret)}},list:async function(){return await n.find()}}},321:(e,t,o)=>{const n=o(185);o(142).config();const s=process.env.DATABASE_URL;n.Promise=global.Promise,n.connect(s,{useNewUrlParser:!0,useUnifiedTopology:!0}).then((()=>console.log("base de datos conectada con exito"))).catch((e=>console.error(`error al conectar la base de datos: ${e}`)))},632:(e,t,o)=>{o(142).config(),o(321),e.exports={port:process.env.PORT||3001,host:process.env.HOST||"http://localhost",dbUri:process.env.DATABASE_URL,username:"lalo",password:"landa",email:"me@me.com",secret:process.env.SECRET_TOKEN||"my-notes-back",apiKey:process.env.API_KEY||"no-key"}},467:e=>{e.exports={handleError:(e,t)=>{e&&console.log(error)}}},260:(e,t,o)=>{const n=o(860)(),s=o(527);n.use(s)},954:(e,t,o)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),o(767);const n=o(632),s=o(344);e.exports={checkApiKey:function(e,t,o){e.headers.api===n.apiKey?o():(t.status(401),t.send("sin autorizacion"))},signToken:function(e,t){return s.sign(e,t)},checkRoles:function(...e){return(t,o,n)=>{const s=t.user;e.includes(s.role)?n():o.status(403).json({status:403,message:"no permitido"})}}}},999:(e,t)=>{"use strict";t.u=void 0;class o{}t.u=o,o.testTypescritp=()=>{console.log("testing typescript")}},829:(e,t,o)=>{const n=o(511),s=o(766),r=o(942);n.use(r),n.use(s)},766:(e,t,o)=>{const{Strategy:n,ExtractJwt:s}=o(136),r=o(632),a=new n({jwtFromRequest:s.fromAuthHeaderAsBearerToken(),secretOrKey:r.secret},((e,t)=>t(null,e)));e.exports=a},942:(e,t,o)=>{const{Strategy:n}=o(55),s=o(340),r=o(96),a=new n((async(e,t,o)=>{try{const n=await s.findOne({username:e});e||o("no sirvio user",!1),await r.compare(t,n.password)||o("sin autorizar contraseÃ±a",!1),o(null,e)}catch(e){o(e,!1)}}));e.exports=a},126:(e,t,o)=>{const n=o(748);e.exports=class{static generateTicket=(e,t,o,s="pending")=>{const r=n.DateTime.now().toLocaleString();return{title:s,body:`${r} - ${o} ${e.money} - ${t}`,footer:e._id,color:"ticket",append:{date:r,value:o,money:e.money,concept:t}}};static approveTicket=(e,t)=>({title:t,body:e.body,footer:e.footer,color:e.color,append:e.append})}},767:e=>{"use strict";e.exports=require("@hapi/boom")},96:e=>{"use strict";e.exports=require("bcrypt")},986:e=>{"use strict";e.exports=require("body-parser")},582:e=>{"use strict";e.exports=require("cors")},142:e=>{"use strict";e.exports=require("dotenv")},860:e=>{"use strict";e.exports=require("express")},344:e=>{"use strict";e.exports=require("jsonwebtoken")},748:e=>{"use strict";e.exports=require("luxon")},185:e=>{"use strict";e.exports=require("mongoose")},511:e=>{"use strict";e.exports=require("passport")},136:e=>{"use strict";e.exports=require("passport-jwt")},55:e=>{"use strict";e.exports=require("passport-local")}},t={};function o(n){var s=t[n];if(void 0!==s)return s.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=o(860),t=o.n(e),n=o(999);const s=o(632),r=o(986),a=o(527),i=o(644),c=o(84),d=o(582),l=t()(),u=(o(260),o(511));n.u.testTypescritp(),l.use(d()),l.use(u.initialize()),o(829),l.use(r.json()),l.use(a),l.use(i),l.use(c),l.listen(s.port,(()=>{console.log(`escuchando en el puerto ${s.host}:${s.port}`)}))})()})();